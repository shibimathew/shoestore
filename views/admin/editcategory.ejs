<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Shoestore Dashboard</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="">
    <meta property="og:type" content="">
    <meta property="og:url" content="">
    <meta property="og:image" content="">
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="assets2/imgs/theme/favicon.svg">
    <!-- Template CSS -->
    <link href="/assets2/css/main.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .screen-wrapper {
            display: flex;
            min-height: 100vh;
        }

        .navbar-aside {
            width: 250px;
            background-color: #f8f9fa;
            flex-shrink: 0;
            min-height: 100vh;
        }

        .main-wrap {
            flex-grow: 1;
            background-color: #fff;
            padding: 20px;
        }
    </style>
</head>

<body>
    <div class="screen-wrapper">
        <!-- Sidebar -->
        <aside class="navbar-aside" id="offcanvas_aside">
            <div class="aside-top">
                <a href="/admin" class="brand-wrap">
                    <img src="/assets/imgs/theme/shoestore-logo.svg" class="logo" alt="Shoestore">
                </a>
                <div>
                    <button class="btn btn-icon btn-aside-minimize">
                        <i class="text-muted material-icons md-menu_open"></i>
                    </button>
                </div>
            </div>
            <nav>
                <ul class="menu-aside">
                    <li class="menu-item">
                        <a class="menu-link" href="/admin/dashboard">
                            <i class="icon material-icons md-home"></i>
                            <span class="text">Dashboard</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a class="menu-link" href="/admin/users">
                            <i class="icon material-icons md-person"></i>
                            <span class="text">Customers</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a class="menu-link" href="/admin/products">
                            <i class="icon material-icons md-shopping_bag"></i>
                            <span class="text">Products</span>
                        </a>
                    </li>
                    <li class="menu-item ">
                        <a class="menu-link" href="/admin/orders">
                            <i class="icon material-icons md-shopping_cart"></i>
                            <span class="text">Orders</span>
                        </a>
                    </li>
                    <li class="menu-item active">
                        <a class="menu-link" href="/admin/category">
                            <i class="icon material-icons md-store"></i>
                            <span class="text">Category</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a class="menu-link" href="/admin/coupons">
                            <i class="icon material-icons md-local_offer"></i>
                            <span class="text">Coupons</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a class="menu-link" href="/admin/sales">
                            <i class="icon material-icons md-assessment"></i>
                            <span class="text">Sales Report</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a class="menu-link" href="/admin/logout">
                            <i class="icon material-icons md-exit_to_app"></i>
                            <span class="text">Sign Out</span>
                        </a>
                    </li>
                </ul>
                <hr>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-wrap">
            <section class="content-main">
                <div class="content-header">
                    <div>
                        <h2 class="content-title">Edit Category</h2>
                        <p>Update category information</p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-12">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h4>Category Details</h4>
                            </div>
                            <div class="card-body">
                                <form method="post" action="/admin/editCategory/<%=category._id%>" onsubmit="handleEditSubmit(event)">
                                    <div class="mb-4">
                                        <label for="product_name" class="form-label">Category Name</label>
                                        <input type="text" name="categoryName" value="<%=category.name%>" placeholder="Enter category name" class="form-control" id="product_name">
                                        <div id="name-error" class="error-message" style="color: red; display: none;"></div>
                                    </div>

                                    <div class="mb-4">
                                        <label class="form-label">Description</label>
                                        <textarea placeholder="Enter category description" name="description" class="form-control" rows="4"><%= category.description %></textarea>
                                        <div id="description-error" class="error-message" style="color: red; display: none;"></div>
                                    </div>

                                    <div class="d-grid">
                                        <button type="submit" class="btn btn-primary">Save Changes</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Scripts -->
    <script>
        function handleEditSubmit(event) {
            event.preventDefault();
            if (!validateForm()) {
                return false;
            }

            const form = event.target;
            const formData = new FormData(form);

            fetch(form.action, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    categoryName: formData.get('categoryName'),
                    description: formData.get('description'),
                    isListed: formData.get('isListed') === "true",
                })
            })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(err => {
                            throw new Error(err.error);
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    Swal.fire({
                        icon: 'success',
                        title: 'Success!',
                        text: 'Category updated successfully',
                        showConfirmButton: false,
                        timer: 1500
                    }).then(() => {
                        window.location.href = '/admin/category';
                    });
                })
                .catch(error => {
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: error.message || 'An error occurred while updating the category'
                    });
                });
        }

        function validateForm() {
            clearErrorMessage();
            const name = document.getElementsByName("categoryName")[0].value.trim();
            const description = document.getElementsByName("description")[0].value;
            let isValid = true;

            if (name === "") {
                displayErrorMessage("name-error", "Please enter a category name");
                isValid = false;
            } else if (!/^[a-zA-Z\s]+$/.test(name)) {
                displayErrorMessage("name-error", "Category name should contain only alphabetic characters");
                isValid = false;
            }

            if (description === "") {
                displayErrorMessage("description-error", "Please enter a description");
                isValid = false;
            }

            return isValid;
        }

        function displayErrorMessage(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.innerText = message;
            errorElement.style.display = "block";
        }

        function clearErrorMessage() {
            const errorElements = document.getElementsByClassName("error-message");
            Array.from(errorElements).forEach((element) => {
                element.innerText = "";
                element.style.display = "none";
            });
        }
    </script>

    <%- include('partials/footer') %>
</body>

</html>
